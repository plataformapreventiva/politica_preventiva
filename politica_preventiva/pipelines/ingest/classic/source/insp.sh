##########################
# INEGI Precios del maiz
# datos de INPC
##########################

echo "Descarga INEGI INPC"
year=$1
month=$2
local_path=$3
local_ingest_file=$4

series='%2C001%2C002%2C003%2C004%2C005%2C006%2C007%2C008%2C009%2C010%2C011%2C012%2C013%2C014%2C015%2C016%2C017%'\
'2C018%2C019%2C020%2C021%2C022%2C023%2C024%2C025%2C026%2C027%2C028%2C029%2C331%2C332%2C342%2C343%2C344%2C345%2C346%2C'\
'011%2C012%2C013%2C014%2C015%2C016%2C017%2C018%2C019%2C020%2C021%2C022%2C023%2C024%2C025%2C026%2C027%2C028%2C029%2C'\
'030%2C031%2C032%2C033%2C034%2C035%2C036%2C037%2C038%2C039%2C040%2C041%2C042%2C043%2C044%2C045%2C046%2C047%2C048%2C'\
'049%2C050%2C051%2C052%2C053%2C054%2C055%2C056%2C057%2C058%2C059%2C060%2C061%2C062%2C063%2C064%2C065%2C066%2C067%2C'\
'068%2C069%2C070%2C071%2C072%2C073%2C074%2C075%2C077%2C076%2C078%2C079%2C080%2C081%2C082%2C083%2C084%2C085%2C086%2C'\
'030%2C031%2C032%2C033%2C034%2C035%2C036%2C037%2C038%2C039%2C040%2C041%2C042%2C043%2C044%2C045%2C046%2C047%2C048%2C'\
'049%2C050%2C051%2C052%2C053%2C054%2C055%2C056%2C057%2C058%2C059%2C060%2C061%2C062%2C063%2C064%2C065%2C066%2C067%2C'\
'068%2C069%2C070%2C071%2C072%2C073%2C074%2C075%2C077%2C076%2C078%2C079%2C080%2C081%2C082%2C083%2C084%2C085%2C086%2C'\
'087%2C088%2C089%2C090%2C091%2C092%2C093%2C094%2C095%2C096%2C097%2C098%2C099%2C100%2C101%2C102%2C103%2C104%2C105%2C'\
'106%2C107%2C108%2C118%2C119%2C120%2C121%2C122%2C123%2C124%2C125%2C126%2C127%2C128%2C129%2C130%2C131%2C132%2C133%2C'\
'134%2C135%2C136%2C137%2C138%2C139%2C140%2C141%2C142%2C143%2C144%2C145%2C146%2C147%2C148%2C158%2C159%2C160%2C161%2C'\
'162%2C163%2C164%2C165%2C166%2C167%2C168%2C169%2C180%2C181%2C182%2C179%2C183%2C184%2C185%2C186%2C187%2C188%2C189%2C'\
'190%2C191%2C192%2C193%2C194%2C195%2C196%2C197%2C198%2C199%2C200%2C201%2C202%2C203%2C208%2C204%2C205%2C206%2C207%2C'\
'209%2C210%2C211%2C212%2C213%2C214%2C215%2C216%2C217%2C218%2C219%2C229%2C230%2C231%2C232%2C233%2C234%2C235%2C236%2C'\
'237%2C238%2C239%2C240%2C241%2C242%2C243%2C244%2C245%2C246%2C247%2C248%2C249%2C250%2C251%2C252%2C253%2C254%2C255%2C'\
'256%2C257%2C258%2C259%2C260%2C261%2C262%2C263%2C264%2C265%2C266%2C276%2C277%2C278%2C279%2C280%2C281%2C282%2C283%2C'\
'284%2C285%2C286%2C287%2C288%2C289%2C290%2C291%2C292%2C293%2C294%2C295%2C296%2C306%2C307%2C308%2C309%2C310%2C311%2C'\
'312%2C313%2C314%2C315%2C316%2C317%2C318%2C319%2C320%2C321%2C322%2C323%2C324%2C325%2C326%2C327%2C328%2C329%2C330%2C'\

entidades='%2C01_08%2C'\
'01_23%2C01_01%2C01_43%2C01_46%2C01_07%2C01_28%2C01_19%2C01_26%2C01_22%2C01_34%2C01_40%2C01_09%2C'\
'01_36%2C01_30%2C01_04%2C01_20%2C01_32%2C01_31%2C01_29%2C01_35%2C01_27%2C01_10%2C01_25%2C01_02%2C01_06%2C01_21%2C'\
'01_05%2C01_03%2C01_38%2C01_11%2C01_39%2C01_42%2C01_12%2C01_18%2C01_13%2C01_45%2C01_44%2C01_37%2C01_24%2C01_41%2C'\
'01_14%2C01_15%2C01_33%2C01_16%2C01_17%2C'

curl 'http://www3.inegi.org.mx/sistemas/inp/preciospromedio/Exportacion.aspx' \
-H 'Host: www3.inegi.org.mx' \
-H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:53.0) Gecko/20100101 Firefox/53.0' \
-H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' \
-H 'Accept-Language: en-US,en;q=0.5' \
--compressed \
-H 'Referer: http://www3.inegi.org.mx/sistemas/inp/preciospromedio/' \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Cookie: LBSesID=ffffffff09da7a1945525d5f4f58455e445a4a423660' \
-H 'DNT: 1' \
-H 'Connection: keep-alive' \
-H 'Upgrade-Insecure-Requests: 1' \
--data 'series='${series}'&tipo=CSV&pi='${year}${month}'&pf='${year}${month}'&ent='${entidades} > $local_path/aux.txt

tail -n +6 $local_path/aux.txt > $local_path/aux2.txt
csvformat -e 'latin1' -D '|' $local_path/aux2.txt > $local_path/aux3.txt
ex -sc '%s/|"|/|/g|x' $local_path/aux3.txt
ex -sc '%s/"//g|x' $local_path/aux3.txt
ex -sc '%s/|"|/|/g|x' $local_path/aux3.txt
cat $local_path/aux3.txt > $local_ingest_file
rm $local_path/aux.txt; rm $local_path/aux2.txt; rm $local_path/aux3.txt
